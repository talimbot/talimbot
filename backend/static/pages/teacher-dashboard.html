<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Version: 2.1 - Fixed VARK 4 options + field preservation -->
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¹Ù„Ù… - Ø³ÛŒØ³ØªÙ… Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', system-ui, -apple-system, sans-serif;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'vazir': ['Vazirmatn', 'system-ui', '-apple-system', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="font-vazir bg-gray-50">
    <div class="min-h-screen">
        <!-- Top Navigation -->
        <nav style="background-color: #1b6e6e;" class="shadow-lg border-b border-gray-200 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center h-16">
                    <!-- Logo -->
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center text-white text-xl font-bold">
                            T
                        </div>
                        <span class="text-xl font-bold text-white">TalimBot</span>
                    </div>

                    <!-- Navigation Links -->
                    <div class="hidden md:flex items-center gap-6">
                        <a href="teacher-dashboard.html" class="text-white font-bold border-b-2 border-white pb-1">
                            Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                        </a>
                        <!-- student-data.html removed - all 30 students already exist -->
                    </div>

                    <!-- User Menu -->
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-2">
                            <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
                                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1z"/>
                                </svg>
                            </div>
                            <div class="hidden md:block text-right">
                                <p class="text-sm font-bold text-white">Ù…Ø¹Ù„Ù…</p>
                                <p class="text-xs text-white/80">Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</p>
                            </div>
                        </div>
                        <a href="login.html" class="text-white/80 hover:text-red-300 transition-colors" title="Ø®Ø±ÙˆØ¬">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Page Header -->
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-2 flex items-center gap-3">
                    <svg class="w-10 h-10 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
                        <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1z"/>
                    </svg>
                    Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ù„Ù…
                </h1>
                <p class="text-gray-600">Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²Ø§Ù†</p>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 py-6 space-y-6">
            <!-- Stats Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-2xl shadow-lg p-6 border-r-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²Ø§Ù†</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2" id="totalStudents">30</p>
                        </div>
                        <div class="bg-blue-100 p-4 rounded-xl">
                            <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-6 border-r-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">Ù¾Ø±ÙˆÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2" id="studentsWithInfo">0</p>
                        </div>
                        <div class="bg-green-100 p-4 rounded-xl">
                            <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-6 border-r-4 border-orange-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm font-medium">Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²Ø§Ù† Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡</p>
                            <p class="text-3xl font-bold text-gray-900 mt-2" id="studentsGrouped">0</p>
                        </div>
                        <div class="bg-orange-100 p-4 rounded-xl">
                            <svg class="w-8 h-8 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course & Status -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Course Name -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"/>
                        </svg>
                        Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø±Ø³
                    </h2>
                    <form id="courseForm" onsubmit="saveCourse(event)" class="space-y-4">
                        <div>
                            <label for="courseNameInput" class="block text-sm font-semibold text-gray-700 mb-2">Ù†Ø§Ù… Ø¯Ø±Ø³</label>
                            <input 
                                type="text" 
                                id="courseNameInput" 
                                placeholder="Ù…Ø«Ø§Ù„: Ø±ÛŒØ§Ø¶ÛŒØŒ Ø§Ø¯Ø¨ÛŒØ§ØªØŒ Ø¹Ù„ÙˆÙ…"
                                class="w-full p-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                                required
                            >
                        </div>
                        <div class="flex justify-center">
                            <button type="submit" class="w-full md:w-1/3 bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                                </svg>
                                Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù… Ø¯Ø±Ø³
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Grouping Status -->
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                        <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                        </svg>
                        ÙˆØ¶Ø¹ÛŒØª Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                    </h2>
                    <div id="statusInfo" class="fade-in">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Grouping Actions -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <span class="text-2xl">âš™ï¸</span>
                    Ø¹Ù…Ù„ÛŒØ§Øª Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                </h2>
                <div class="space-y-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                        <h4 class="font-bold text-blue-900 mb-2 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                            </svg>
                            Ø¢Ù…Ø§Ø¯Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                        </h4>
                        <p class="text-gray-700 mb-2">
                            <strong class="text-2xl text-blue-600" id="readyStudentsCount">0</strong> 
                            Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¢Ù…Ø§Ø¯Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‡Ø³ØªÙ†Ø¯.
                        </p>
                        <div class="text-sm text-gray-700 space-y-1 bg-white rounded-lg p-3 mt-2">
                            <p class="font-semibold text-gray-800 mb-2">ğŸ¯ Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¹Ù„Ù…ÛŒ (Ø³Ù†ÛŒÙ† 15-16 Ø³Ø§Ù„ØŒ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø§ÙˆÙ„ÙˆÛŒØª):</p>
                            <div class="mr-4 space-y-1">
                                <p><strong>1. Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ ZPD Ù†Ø§Ø­ÛŒÙ‡ Ø±Ø´Ø¯ Ù†Ø²Ø¯ÛŒÚ© (30%):</strong> ØªØ±Ú©ÛŒØ¨ Ù†Ù…Ø±Ø§Øª Ø¨Ø§Ù„Ø§ Ø¨Ø§ Ù…ØªÙˆØ³Ø· Ø¨Ø±Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù‡Ù…ÛŒØ§Ø±ÛŒ Ùˆ Ø¢Ù…ÙˆØ²Ø´ Ù‡Ù…ØªØ§-Ø¨Ù‡-Ù‡Ù…ØªØ§</p>
                                <p><strong>2. ØªÚ©Ù…ÛŒÙ„ MBTI (25%):</strong> ØªØ±Ú©ÛŒØ¨ Ø´Ø®ØµÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ú©Ù…Ù„ (Ù†Ù‡ Ù…Ø´Ø§Ø¨Ù‡) - Ù…Ø«Ø§Ù„: ENFP+INTJØŒ ENTP+INFJ - ØªØ¹Ø§Ø¯Ù„ Ø¯Ø±ÙˆÙ†â€ŒÚ¯Ø±Ø§/Ø¨Ø±ÙˆÙ†â€ŒÚ¯Ø±Ø§</p>
                                <p><strong>3. ØªÙ†ÙˆØ¹ VARK (20%):</strong> ØªØ±Ú©ÛŒØ¨ Ø³Ø¨Ú©â€ŒÙ‡Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø¯ÛŒØ¯Ø§Ø±ÛŒØŒ Ø´Ù†ÛŒØ¯Ø§Ø±ÛŒØŒ Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ† Ùˆ Ø­Ø±Ú©ØªÛŒ Ø¯Ø± Ù‡Ø± Ú¯Ø±ÙˆÙ‡</p>
                                <p><strong>4. Ø§Ù†Ú¯ÛŒØ²Ø´ ØªØ­ØµÛŒÙ„ÛŒ - AMS (15%):</strong> ØªÙˆØ²ÛŒØ¹ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø§ Ø§Ù†Ú¯ÛŒØ²Ù‡ Ø¨Ø§Ù„Ø§ (>140) Ø¯Ø± Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ù„Ù‡Ø§Ù…â€ŒØ¨Ø®Ø´ÛŒ</p>
                                <p><strong>5. Ù…Ù‡Ø§Ø±Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ (10%):</strong> Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø§ Ù…Ù‡Ø§Ø±Øª Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§Ù„Ø§ (>88) Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ØªØ³Ù‡ÛŒÙ„â€ŒÚ¯Ø± Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ</p>
                                <p><strong>6. ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø³:</strong> <span id="courseNameInCriteria">ØªØ·Ø¨ÛŒÙ‚ Ø¨Ø§ Ù†ÛŒØ§Ø²Ù‡Ø§ÛŒ Ø¯Ø±Ø³ (Ø±ÛŒØ§Ø¶ÛŒ: ØªÙÚ©Ø± Ù…Ù†Ø·Ù‚ÛŒØŒ Ø§Ø¯Ø¨ÛŒØ§Øª: Ø§Ø­Ø³Ø§Ø³ÛŒ)</span></p>
                                <p class="text-orange-600 italic mt-1"><strong>7. ØªØ±Ø¬ÛŒØ­Ø§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† (5%):</strong> ÙÙ‚Ø· Ø§Ú¯Ø± Ø¨Ø§ Ù…Ø¹ÛŒØ§Ø±Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ ØªØ¶Ø§Ø¯ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ - Ù†ÙˆØ¬ÙˆØ§Ù†Ø§Ù† Ø§Ø² Ú©Ø§Ø± Ø¨Ø§ Ø§ÙØ±Ø§Ø¯ Ø¬Ø¯ÛŒØ¯ Ø±Ø´Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯</p>
                            </div>
                        </div>
                        <div class="bg-amber-50 border border-amber-300 rounded-lg p-3 mt-3">
                            <p class="text-sm text-amber-800 font-medium">
                                âš¡ Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…: ÙÙ‚Ø· Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†ÛŒ Ú©Ù‡ MBTI Ùˆ Ø³Ø¨Ú© ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø®ÙˆØ¯ Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯ Ø¯Ø± Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø±Ú©Øª Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯. 
                                Ø§Ú¯Ø± Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø¯ÙˆØ³ØªØ§Ù† Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡ ÙˆÙ„ÛŒ Ø¢Ù† Ø¯ÙˆØ³ØªØ§Ù† ÙØ±Ù… Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯ØŒ Ø§ÛŒÙ† Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.
                            </p>
                        </div>
                    </div>

                    <div id="groupingActions" class="flex flex-col items-center gap-4">
                        <button onclick="startGrouping()" id="startGroupingBtn"
                                class="w-full md:w-1/3 bg-gradient-to-r from-green-600 to-green-700 text-white py-4 rounded-xl font-bold text-lg hover:from-green-700 hover:to-green-800 transform hover:scale-[1.02] active:scale-[0.98] transition-all shadow-lg flex items-center justify-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            Ø´Ø±ÙˆØ¹ ÙØ±Ø¢ÛŒÙ†Ø¯ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                        </button>
                        
                        <button onclick="handleResetGrouping()" id="resetGroupingBtn"
                                class="hidden w-full md:w-1/3 bg-gray-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-700 transform hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                        </button>
                        <button onclick="toggleVisibility()" id="toggleVisibilityBtn"
                                class="hidden w-full md:w-1/3 bg-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-700 transform hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                            <span id="visibilityButtonText">Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ø¨Ù‡ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</span>
                        </button>
                    </div>

                    <div id="groupingProgress" class="hidden text-center py-8">
                        <div class="inline-block w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                        <p class="text-gray-700 font-semibold">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ...</p>
                        <p class="text-sm text-gray-500 mt-2">Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡ Ø·ÙˆÙ„ Ø¨Ú©Ø´Ø¯</p>
                    </div>

                    <div id="groupingSuccess" class="hidden bg-green-50 border-r-4 border-green-500 p-4 rounded-lg">
                        <p class="text-green-700 font-semibold flex items-center gap-2">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!
                        </p>
                    </div>
                </div>
            </div>

            <!-- Students List -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <span class="text-2xl">ğŸ“‹</span>
                    Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²Ø§Ù†
                </h2>
                
                <div class="text-center mb-4 flex gap-3 justify-center">
                    <button onclick="toggleStudentList()" id="toggleStudentBtn"
                            class="bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                        Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²Ø§Ù†
                    </button>
                    <button onclick="downloadAllData()" 
                            class="bg-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-700 transition-colors">
                        ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ (JSON)
                    </button>
                </div>
                <div id="studentListContainer" class="hidden">
                    <div class="overflow-x-auto rounded-xl border border-gray-200">
                        <table class="w-full">
                            <thead class="bg-gray-100 sticky top-0">
                                <tr class="border-b-2 border-blue-500">
                                    <th class="p-3 text-right text-sm font-bold text-gray-700">Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²</th>
                                    <th class="p-3 text-right text-sm font-bold text-gray-700">Ù†Ø§Ù…</th>
                                    <th class="p-3 text-center text-sm font-bold text-gray-700">MBTI</th>
                                    <th class="p-3 text-center text-sm font-bold text-gray-700">Ø³Ø¨Ú© ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ</th>
                                    <th class="p-3 text-center text-sm font-bold text-gray-700">AMS</th>
                                    <th class="p-3 text-center text-sm font-bold text-gray-700">Cooperative</th>
                                    <th class="p-3 text-center text-sm font-bold text-gray-700">Ù…Ø¹Ø¯Ù„</th>
                                    <th class="p-3 text-center text-sm font-bold text-gray-700">Ú¯Ø±ÙˆÙ‡</th>
                                    <th class="p-3 text-center text-sm font-bold text-gray-700">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="studentTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reset Data Section -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border-r-4 border-orange-500">
                <div class="flex items-start gap-4">
                    <div class="flex-shrink-0">
                        <svg class="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</h3>
                        <p class="text-sm text-gray-600 mb-4">
                            Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÛŒØ³ØªÙ… Ø±Ø§ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø²Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯. Ù‡Ù…Ù‡ 30 Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² (S001 ØªØ§ S030) Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŒ 
                            ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ùˆ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ùˆ Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯.
                        </p>
                        <button onclick="resetAllData()" class="bg-orange-600 hover:bg-orange-700 text-white py-3 px-6 rounded-xl font-semibold transition-colors flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                            Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                        </button>
                    </div>
                </div>
            </div>

            <!-- Test Data Generator Section -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border-r-4 border-green-500">
                <div class="flex items-start gap-4">
                    <div class="flex-shrink-0">
                        <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM14 11a1 1 0 011 1v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1h-1a1 1 0 110-2h1v-1a1 1 0 011-1z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª</h3>
                        <p class="text-sm text-gray-600 mb-4">
                            Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒØŒ 10 Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø§ÙˆÙ„ (S001 ØªØ§ S010) Ø±Ø§ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù…Ù„ Ùˆ ØªØµØ§Ø¯ÙÛŒ Ù¾Ø± Ú©Ù†ÛŒØ¯. 
                            Ø§ÛŒÙ† Ø´Ø§Ù…Ù„ MBTIØŒ VARKØŒ Ù†Ù…Ø±Ø§Øª AMS Ùˆ Cooperative Ùˆ ØªØ±Ø¬ÛŒØ­Ø§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
                        </p>
                        <div class="flex gap-3">
                            <button onclick="fillTestData()" id="fillTestDataBtn" class="bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-xl font-semibold transition-colors flex items-center gap-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM14 11a1 1 0 011 1v1h1a1 1 0 110 2h-1v1a1 1 0 11-2 0v-1h-1a1 1 0 110-2h1v-1a1 1 0 011-1z"/>
                                </svg>
                                Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
                            </button>
                            <div id="testDataProgress" class="hidden flex items-center gap-2 text-sm text-gray-600">
                                <div class="inline-block w-5 h-5 border-2 border-green-600 border-t-transparent rounded-full animate-spin"></div>
                                <span id="testDataProgressText">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Import JSON Data Section -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border-r-4 border-blue-500">
                <div class="flex items-start gap-4">
                    <div class="flex-shrink-0">
                        <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² JSON</h3>
                        <p class="text-sm text-gray-600 mb-4">
                            ÛŒÚ© ÙØ§ÛŒÙ„ JSON Ø­Ø§ÙˆÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. ÙØ§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø´Ø§Ù…Ù„ Ø¢Ø±Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ø§Ø² Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨Ø§ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ 
                            mbtiØŒ learningStyleØŒ amsØŒ cooperative Ùˆ preferredStudents Ø¨Ø§Ø´Ø¯.
                        </p>
                        <div class="flex gap-3 items-center">
                            <input type="file" id="jsonFileInput" accept=".json" class="hidden">
                            <button onclick="document.getElementById('jsonFileInput').click()" class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-xl font-semibold transition-colors flex items-center gap-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                </svg>
                                Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ JSON
                            </button>
                            <span id="jsonFileName" class="text-sm text-gray-600"></span>
                            <div id="jsonImportProgress" class="hidden flex items-center gap-2 text-sm text-gray-600">
                                <div class="inline-block w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
                                <span id="jsonImportProgressText">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Group Results -->
            <div id="groupResultsCard" class="hidden bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <svg class="w-6 h-6 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                    </svg>
                    Ù†ØªØ§ÛŒØ¬ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                </h2>
                <div id="groupResultsList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Footer -->
            <footer class="bg-white border-t border-gray-200 mt-16">
                <div class="max-w-7xl mx-auto px-4 py-6">
                    <div class="text-center text-gray-600 text-sm">
                        <p class="mb-2">Ù†Ø³Ø®Ù‡ 1.0.0 | Ø¢Ø¨Ø§Ù† 1404</p>
                        <p>Â© Û²Û°Û²Ûµ TalimBot - Ø³ÛŒØ³ØªÙ… Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²Ø§Ù†</p>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script src="../assets/js/data.js"></script>
    <script src="../assets/js/grouping.js"></script>
    <script>
        let isStudentListVisible = false;

        // Check if user is authenticated as teacher
        function checkAuth() {
            const isTeacher = sessionStorage.getItem('isTeacher');
            if (!isTeacher) {
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        async function loadDashboard() {
            if (!checkAuth()) return;

            const stats = await getGroupingStats();
            const courseName = await getCourseName();

            document.getElementById('totalStudents').textContent = stats.totalStudents;
            document.getElementById('studentsWithInfo').textContent = stats.studentsWithCompleteInfo;
            document.getElementById('studentsGrouped').textContent = stats.studentsGrouped;
            document.getElementById('readyStudentsCount').textContent = stats.studentsWithCompleteInfo;

            if (courseName) {
                document.getElementById('courseNameInput').value = courseName;
                // Update the course name in the criteria description
                const courseNameEl = document.getElementById('courseNameInCriteria');
                if (courseNameEl) {
                    courseNameEl.textContent = `Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÛŒØ§Ø² Ø¯Ø±Ø³ "${courseName}"`;
                }
            }

            await updateStatus(stats);
            await updateStudentTable();
        }

        async function updateStatus(stats) {
            const statusDiv = document.getElementById('statusInfo');
            const toggleBtn = document.getElementById('toggleVisibilityBtn');
            const toggleBtnText = document.getElementById('visibilityButtonText');

            if (stats.groupingComplete) {
                statusDiv.innerHTML = `
                    <div class="bg-green-50 border-r-4 border-green-500 p-4 rounded-lg">
                        <p class="font-bold text-green-700 mb-1 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!
                        </p>
                        <p class="text-sm text-green-600">${stats.studentsGrouped} Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¯Ø± ${stats.groups.length} Ú¯Ø±ÙˆÙ‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ø³ <strong>${stats.courseName}</strong></p>
                        ${stats.resultsVisible ? 
                            '<p class="text-sm text-blue-600 mt-2">âœ… Ù†ØªØ§ÛŒØ¬ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>' : 
                            '<p class="text-sm text-orange-600 mt-2">âš ï¸ Ù†ØªØ§ÛŒØ¬ Ù‡Ù†ÙˆØ² Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø®ÙÛŒ Ø§Ø³Øª</p>'}
                    </div>
                `;
                document.getElementById('startGroupingBtn').classList.add('hidden');
                document.getElementById('resetGroupingBtn').classList.remove('hidden');
                toggleBtn.classList.remove('hidden');
                
                // Update button text based on visibility status
                if (stats.resultsVisible) {
                    toggleBtnText.textContent = 'Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ø§Ø² Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†';
                    toggleBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    toggleBtn.classList.add('bg-orange-600', 'hover:bg-orange-700');
                } else {
                    toggleBtnText.textContent = 'Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ø¨Ù‡ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†';
                    toggleBtn.classList.remove('bg-orange-600', 'hover:bg-orange-700');
                    toggleBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }
                
                await displayGroupResults(stats.groups);
            } else {
                statusDiv.innerHTML = `
                    <div class="bg-blue-50 border-r-4 border-blue-500 p-4 rounded-lg">
                        <p class="font-bold text-blue-700 mb-1">â„¹ï¸ Ø¢Ù…Ø§Ø¯Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</p>
                        <p class="text-sm text-blue-600">${stats.studentsWithCompleteInfo} Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¢Ù…Ø§Ø¯Ù‡ Ù‡Ø³ØªÙ†Ø¯</p>
                    </div>
                `;
                document.getElementById('startGroupingBtn').classList.remove('hidden');
                document.getElementById('resetGroupingBtn').classList.add('hidden');
                toggleBtn.classList.add('hidden');
                document.getElementById('groupResultsCard').classList.add('hidden');
            }
        }

        function saveCourse(event) {
            event.preventDefault();
            const courseName = document.getElementById('courseNameInput').value.trim();
            
            if (courseName) {
                setCourseName(courseName);
                // Update the display immediately
                const courseNameEl = document.getElementById('courseNameInCriteria');
                if (courseNameEl) {
                    courseNameEl.textContent = `Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÛŒØ§Ø² Ø¯Ø±Ø³ "${courseName}"`;
                }
                alert('Ù†Ø§Ù… Ø¯Ø±Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
            }
        }

        async function startGrouping() {
            const courseName = document.getElementById('courseNameInput').value.trim();
            
            if (!courseName) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù†Ø§Ù… Ø¯Ø±Ø³ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }

            const stats = await getGroupingStats();
            
            if (stats.studentsWithCompleteInfo === 0) {
                alert('Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²ÛŒ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ù†Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª!');
                return;
            }

            const confirmed = confirm(`Ø¢Ù…Ø§Ø¯Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ${stats.studentsWithCompleteInfo} Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²ØŸ`);
            if (!confirmed) return;

            document.getElementById('groupingActions').classList.add('hidden');
            document.getElementById('groupingProgress').classList.remove('hidden');

            try {
                const groupingResult = await performGrouping(courseName);
                
                document.getElementById('groupingProgress').classList.add('hidden');
                document.getElementById('groupingSuccess').classList.remove('hidden');
                document.getElementById('groupingActions').classList.remove('hidden');
                
                setTimeout(() => {
                    loadDashboard();
                }, 2000);
                
            } catch (error) {
                let errorMsg = 'Ø®Ø·Ø§ Ø¯Ø± Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ: ' + error.message;
                alert(errorMsg);
                
                document.getElementById('groupingProgress').classList.add('hidden');
                document.getElementById('groupingActions').classList.remove('hidden');
            }
        }

        async function handleResetGrouping() {
            if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯ØŸ\n\nâœ“ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯\nâœ“ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† (MBTIØŒ VARKØŒ AMSØŒ Cooperative) Ø­ÙØ¸ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯\nâœ“ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯')) return;
            
            const password = prompt('Ù„Ø·ÙØ§Ù‹ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø³ØªØ§Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
            if (!password) return;

            try {
                await resetGrouping(password);
                // Hide success message
                document.getElementById('groupingSuccess').classList.add('hidden');
                alert('âœ… Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯!\n\nØ§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø­ÙØ¸ Ø´Ø¯Ù‡ Ùˆ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù†ÛŒØ¯.');
                loadDashboard();
            } catch (error) {
                if (error.message.includes('Invalid password')) {
                    alert('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!');
                } else {
                    alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ: ' + error.message);
                }
            }
        }

        async function toggleVisibility() {
            const password = prompt('Ù„Ø·ÙØ§Ù‹ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø³ØªØ§Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
            if (!password) return;

            try {
                const result = await toggleResultsVisibility(password);
                if (result.success) {
                    const message = result.resultsVisible ? 
                        'Ù†ØªØ§ÛŒØ¬ Ø§Ú©Ù†ÙˆÙ† Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø³Øª! âœ…' : 
                        'Ù†ØªØ§ÛŒØ¬ Ø§Ø² Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ù…Ø®ÙÛŒ Ø´Ø¯! ğŸ”’';
                    alert(message);
                    loadDashboard();
                } else {
                    alert('Ø®Ø·Ø§ Ø¯Ø± ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ù†Ù…Ø§ÛŒØ´');
                }
            } catch (error) {
                if (error.message.includes('Invalid password')) {
                    alert('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!');
                } else {
                    alert('Ø®Ø·Ø§: ' + error.message);
                }
            }
        }

        async function displayGroupResults(groups) {
            const card = document.getElementById('groupResultsCard');
            const container = document.getElementById('groupResultsList');
            
            card.classList.remove('hidden');
            container.innerHTML = '';

            const allStudents = await getAllStudents();

            groups.forEach(group => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300 rounded-xl p-4';
                
                let html = `<h3 class="font-bold text-blue-900 mb-3">Ú¯Ø±ÙˆÙ‡ ${group.groupNumber} (${group.students.length} Ù†ÙØ±)</h3>`;
                
                if (group.reasoning) {
                    html += `<p class="text-xs text-blue-700 mb-3 italic">${group.reasoning}</p>`;
                }
                
                html += '<ul class="space-y-1">';
                group.students.forEach(studentNumber => {
                    const student = allStudents.find(s => s.studentNumber === studentNumber);
                    if (student) {
                        html += `<li class="text-sm text-gray-700">ğŸ‘¤ ${student.name} (${student.mbti || 'N/A'})</li>`;
                    }
                });
                html += '</ul>';
                
                groupDiv.innerHTML = html;
                container.appendChild(groupDiv);
            });
        }

        function toggleStudentList() {
            isStudentListVisible = !isStudentListVisible;
            const container = document.getElementById('studentListContainer');
            const btn = document.getElementById('toggleStudentBtn');
            
            container.classList.toggle('hidden', !isStudentListVisible);
            btn.textContent = isStudentListVisible ? 'Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª' : 'Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ²Ø§Ù†';
        }

        async function updateStudentTable() {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';

            const allStudents = await getAllStudents();

            allStudents.forEach((student, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';
                tr.id = `row-${student.studentNumber}`;
                tr.innerHTML = `
                    <td class="p-3 text-sm">${student.studentNumber}</td>
                    <td class="p-3 text-sm">
                        <span class="view-mode">${student.name}</span>
                        <input type="text" class="edit-mode hidden w-full p-1 border border-gray-300 rounded" value="${student.name}">
                    </td>
                    <td class="p-3 text-sm text-center">
                        <span class="view-mode">${student.mbti || '-'}</span>
                        <select class="edit-mode hidden w-full p-1 border border-gray-300 rounded text-xs">
                            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                            <option value="INTJ" ${student.mbti === 'INTJ' ? 'selected' : ''}>INTJ</option>
                            <option value="INTP" ${student.mbti === 'INTP' ? 'selected' : ''}>INTP</option>
                            <option value="ENTJ" ${student.mbti === 'ENTJ' ? 'selected' : ''}>ENTJ</option>
                            <option value="ENTP" ${student.mbti === 'ENTP' ? 'selected' : ''}>ENTP</option>
                            <option value="INFJ" ${student.mbti === 'INFJ' ? 'selected' : ''}>INFJ</option>
                            <option value="INFP" ${student.mbti === 'INFP' ? 'selected' : ''}>INFP</option>
                            <option value="ENFJ" ${student.mbti === 'ENFJ' ? 'selected' : ''}>ENFJ</option>
                            <option value="ENFP" ${student.mbti === 'ENFP' ? 'selected' : ''}>ENFP</option>
                            <option value="ISTJ" ${student.mbti === 'ISTJ' ? 'selected' : ''}>ISTJ</option>
                            <option value="ISFJ" ${student.mbti === 'ISFJ' ? 'selected' : ''}>ISFJ</option>
                            <option value="ESTJ" ${student.mbti === 'ESTJ' ? 'selected' : ''}>ESTJ</option>
                            <option value="ESFJ" ${student.mbti === 'ESFJ' ? 'selected' : ''}>ESFJ</option>
                            <option value="ISTP" ${student.mbti === 'ISTP' ? 'selected' : ''}>ISTP</option>
                            <option value="ISFP" ${student.mbti === 'ISFP' ? 'selected' : ''}>ISFP</option>
                            <option value="ESTP" ${student.mbti === 'ESTP' ? 'selected' : ''}>ESTP</option>
                            <option value="ESFP" ${student.mbti === 'ESFP' ? 'selected' : ''}>ESFP</option>
                        </select>
                    </td>
                    <td class="p-3 text-sm text-center">
                        <span class="view-mode">${student.learningStyle || '-'}</span>
                        <select class="edit-mode hidden w-full p-1 border border-gray-300 rounded text-xs">
                            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                            <option value="Visual" ${student.learningStyle === 'Visual' ? 'selected' : ''}>Visual (Ø¯ÛŒØ¯Ø§Ø±ÛŒ)</option>
                            <option value="Aural" ${student.learningStyle === 'Aural' ? 'selected' : ''}>Aural (Ø´Ù†ÛŒØ¯Ø§Ø±ÛŒ)</option>
                            <option value="Read/Write" ${student.learningStyle === 'Read/Write' ? 'selected' : ''}>Read/Write (Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ†)</option>
                            <option value="Kinesthetic" ${student.learningStyle === 'Kinesthetic' ? 'selected' : ''}>Kinesthetic (Ø­Ø±Ú©ØªÛŒ/Ø¹Ù…Ù„ÛŒ)</option>
                        </select>
                    </td>
                    <td class="p-3 text-sm text-center">
                        <span class="view-mode">${student.ams || '-'}</span>
                        <input type="text" class="edit-mode hidden w-full p-1 border border-gray-300 rounded text-xs" value="${student.ams || ''}">
                    </td>
                    <td class="p-3 text-sm text-center">
                        <span class="view-mode">${student.cooperative || '-'}</span>
                        <input type="text" class="edit-mode hidden w-full p-1 border border-gray-300 rounded text-xs" value="${student.cooperative || ''}">
                    </td>
                    <td class="p-3 text-sm text-center font-semibold">
                        <span class="view-mode">${student.grade}</span>
                        <input type="number" class="edit-mode hidden w-20 p-1 border border-gray-300 rounded text-center" value="${student.grade}" min="0" max="20" step="0.1">
                    </td>
                    <td class="p-3 text-sm text-center text-blue-600 font-bold">${student.group || '-'}</td>
                    <td class="p-3 text-center">
                        <div class="flex gap-1 justify-center">
                            <button onclick="editStudent('${student.studentNumber}')" class="view-mode bg-blue-600 text-white px-3 py-1 rounded-lg text-xs hover:bg-blue-700">
                                âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´
                            </button>
                            <button onclick="saveStudent('${student.studentNumber}')" class="edit-mode hidden bg-green-600 text-white px-3 py-1 rounded-lg text-xs hover:bg-green-700">
                                âœ“ Ø°Ø®ÛŒØ±Ù‡
                            </button>
                            <button onclick="cancelEdit('${student.studentNumber}')" class="edit-mode hidden bg-gray-600 text-white px-3 py-1 rounded-lg text-xs hover:bg-gray-700">
                                âœ• Ù„ØºÙˆ
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function editStudent(studentNumber) {
            const row = document.getElementById(`row-${studentNumber}`);
            row.querySelectorAll('.view-mode').forEach(el => el.classList.add('hidden'));
            row.querySelectorAll('.edit-mode').forEach(el => el.classList.remove('hidden'));
        }

        function cancelEdit(studentNumber) {
            const row = document.getElementById(`row-${studentNumber}`);
            row.querySelectorAll('.edit-mode').forEach(el => el.classList.add('hidden'));
            row.querySelectorAll('.view-mode').forEach(el => el.classList.remove('hidden'));
        }

        async function saveStudent(studentNumber) {
            const row = document.getElementById(`row-${studentNumber}`);
            
            // Get specific input elements - order matters!
            const textInputs = row.querySelectorAll('input[type="text"]');
            const nameInput = textInputs[0];  // First text input is name
            const amsInput = textInputs[1];   // Second text input is AMS
            const cooperativeInput = textInputs[2];  // Third text input is cooperative
            const mbtiSelect = row.querySelectorAll('select')[0];
            const learningStyleSelect = row.querySelectorAll('select')[1];
            const gradeInput = row.querySelector('input[type="number"]');
            
            // Build update object with only non-empty values to prevent overwriting existing data
            const updatedData = {};
            
            const name = nameInput.value.trim();
            const mbti = mbtiSelect.value;
            const learningStyle = learningStyleSelect.value;
            const ams = amsInput.value.trim();
            const cooperative = cooperativeInput.value.trim();
            const grade = gradeInput.value;

            // Name is required
            if (!name) {
                alert('Ù†Ø§Ù… Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯!');
                return;
            }
            updatedData.name = name;

            // Only include other fields if they have values
            if (mbti) updatedData.mbti = mbti;
            if (learningStyle) updatedData.learningStyle = learningStyle;
            if (ams) updatedData.ams = ams;
            if (cooperative) updatedData.cooperative = cooperative;
            if (grade) updatedData.grade = parseFloat(grade);

            // Update student using the proper data.js function
            const success = await updateStudent(studentNumber, updatedData);
            
            if (success) {
                alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
                cancelEdit(studentNumber);
                await updateStudentTable();
                await loadDashboard();
            } else {
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª!');
            }
        }

        async function resetAllData() {
            if (!confirm('âš ï¸ Ù‡Ø´Ø¯Ø§Ø±: Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª!\n\nØ¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯ØŸ\n\nâ€¢ Ù‡Ù…Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† (MBTIØŒ VARKØŒ AMSØŒ CooperativeØŒ ØªØ±Ø¬ÛŒØ­Ø§Øª) Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯\nâ€¢ ØªÙ…Ø§Ù… Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ù¾Ø§Ú© Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯\nâ€¢ Ù†Ø§Ù… Ø¯Ø±Ø³ Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯\nâ€¢ Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯')) {
                return;
            }

            const password = prompt('Ù„Ø·ÙØ§Ù‹ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø³ØªØ§Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
            if (!password) return;

            try {
                const result = await fetch(`${API_BASE_URL}/data/reset-all`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                
                if (!result.ok) {
                    const error = await result.json();
                    throw new Error(error.detail || 'Reset failed');
                }
                
                alert('âœ… ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯!\n\nØ³ÛŒØ³ØªÙ… Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯.');
                window.location.reload();
            } catch (error) {
                if (error.message.includes('Invalid password') || error.message.includes('403')) {
                    alert('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!');
                } else {
                    alert('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ: ' + error.message);
                }
            }
        }

        // Test data generator
        async function fillTestData() {
            if (!confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ 10 Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø§ÙˆÙ„ (S001 ØªØ§ S010) Ø±Ø§ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ú©Ø§Ù…Ù„ Ù¾Ø± Ú©Ù†ÛŒØ¯ØŸ\n\nØ§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯.')) {
                return;
            }

            const MBTI_TYPES = ['INTJ', 'INTP', 'ENTJ', 'ENTP', 'INFJ', 'INFP', 'ENFJ', 'ENFP', 
                               'ISTJ', 'ISFJ', 'ESTJ', 'ESFJ', 'ISTP', 'ISFP', 'ESTP', 'ESFP'];
            const VARK_STYLES = ['Visual', 'Aural', 'Read/Write', 'Kinesthetic'];

            function randomChoice(arr) {
                return arr[Math.floor(Math.random() * arr.length)];
            }

            function randomInt(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            const btn = document.getElementById('fillTestDataBtn');
            const progress = document.getElementById('testDataProgress');
            const progressText = document.getElementById('testDataProgressText');

            btn.disabled = true;
            progress.classList.remove('hidden');

            let successCount = 0;

            try {
                for (let i = 1; i <= 10; i++) {
                    const studentId = `S${String(i).padStart(3, '0')}`;
                    progressText.textContent = `Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ ${studentId}... (${successCount}/10)`;

                    // Generate 2-3 random preferred students (excluding self)
                    const allStudents = Array.from({length: 30}, (_, idx) => `S${String(idx + 1).padStart(3, '0')}`);
                    const otherStudents = allStudents.filter(s => s !== studentId);
                    const numPreferred = randomInt(2, 3);
                    const preferred = [];
                    for (let j = 0; j < numPreferred; j++) {
                        const randomStudent = otherStudents[Math.floor(Math.random() * otherStudents.length)];
                        if (!preferred.includes(randomStudent)) {
                            preferred.push(randomStudent);
                        }
                    }

                    const testData = {
                        mbti: randomChoice(MBTI_TYPES),
                        learningStyle: randomChoice(VARK_STYLES),
                        ams: String(randomInt(80, 180)),
                        cooperative: String(randomInt(60, 120)),
                        preferredStudents: preferred
                    };

                    await updateStudent(studentId, testData);
                    successCount++;
                    progressText.textContent = `${studentId} Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯... (${successCount}/10)`;
                }

                progress.classList.add('hidden');
                alert(`âœ… Ù…ÙˆÙÙ‚!\n\n10 Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ù¾Ø± Ø´Ø¯Ù†Ø¯:\nâ€¢ MBTI: ØªØµØ§Ø¯ÙÛŒ Ø§Ø² 16 Ù†ÙˆØ¹\nâ€¢ VARK: ${VARK_STYLES.join(', ')}\nâ€¢ AMS: 80-180\nâ€¢ Cooperative: 60-120\nâ€¢ ØªØ±Ø¬ÛŒØ­Ø§Øª: 2-3 Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù†ÙØ±\n\nØ­Ø§Ù„Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ØªØ³Øª Ú©Ù†ÛŒØ¯!`);
                window.location.reload();
            } catch (error) {
                progress.classList.add('hidden');
                alert('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª: ' + error.message);
            } finally {
                btn.disabled = false;
            }
        }

        // JSON file import handler
        document.getElementById('jsonFileInput').addEventListener('change', async function(event) {
            const file = event.target.files[0];
            if (!file) return;

            document.getElementById('jsonFileName').textContent = file.name;

            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    
                    // Accept both formats: direct array or {students: [...]} object
                    let studentsArray;
                    if (Array.isArray(jsonData)) {
                        studentsArray = jsonData;
                    } else if (jsonData.students && Array.isArray(jsonData.students)) {
                        studentsArray = jsonData.students;
                    } else {
                        alert('Ø®Ø·Ø§: ÙØ§ÛŒÙ„ JSON Ø¨Ø§ÛŒØ¯ Ø´Ø§Ù…Ù„ Ø¢Ø±Ø§ÛŒÙ‡ students Ø¨Ø§Ø´Ø¯ ÛŒØ§ ÛŒÚ© Ø¢Ø±Ø§ÛŒÙ‡ Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø² Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†.');
                        return;
                    }

                    if (!confirm(`Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ${studentsArray.length} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø±Ø§ Ø§Ø² ÙØ§ÛŒÙ„ JSON ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ØŸ\n\nØ§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯.`)) {
                        return;
                    }

                    const progress = document.getElementById('jsonImportProgress');
                    const progressText = document.getElementById('jsonImportProgressText');
                    
                    progress.classList.remove('hidden');
                    let successCount = 0;
                    let errorCount = 0;

                    for (const student of studentsArray) {
                        // Validate required field
                        if (!student.studentNumber) {
                            console.warn('Student missing studentNumber, skipping:', student);
                            errorCount++;
                            continue;
                        }

                        progressText.textContent = `Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ ${student.studentNumber}... (${successCount}/${studentsArray.length})`;

                        // Build update object with only provided fields
                        const updates = {};
                        if (student.mbti) updates.mbti = student.mbti;
                        if (student.learningStyle) updates.learningStyle = student.learningStyle;
                        if (student.ams !== undefined && student.ams !== null) updates.ams = String(student.ams);
                        if (student.cooperative !== undefined && student.cooperative !== null) updates.cooperative = String(student.cooperative);
                        if (student.preferredStudents) updates.preferredStudents = student.preferredStudents;

                        try {
                            await updateStudent(student.studentNumber, updates);
                            successCount++;
                        } catch (error) {
                            console.error(`Error updating ${student.studentNumber}:`, error);
                            errorCount++;
                        }
                    }

                    progress.classList.add('hidden');
                    
                    let message = `âœ… Ù…ÙˆÙÙ‚!\n\n${successCount} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯.`;
                    if (errorCount > 0) {
                        message += `\n\nâš ï¸ ${errorCount} Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¯Ø§Ø±Ø§ÛŒ Ø®Ø·Ø§ Ø¨ÙˆØ¯Ù†Ø¯.`;
                    }
                    
                    alert(message);
                    window.location.reload();

                } catch (error) {
                    alert('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ JSON: ' + error.message);
                    document.getElementById('jsonImportProgress').classList.add('hidden');
                }
            };

            reader.readAsText(file);
        });

        async function downloadAllData() {
            try {
                const response = await fetch(`${API_BASE_URL}/data/backup`);
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                
                const data = await response.json();
                
                // Create a blob with the JSON data
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                
                // Create download link
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                // Generate filename with current date/time
                const now = new Date();
                const dateStr = now.toISOString().replace(/[:.]/g, '-').slice(0, -5);
                a.download = `talimbot-data-${dateStr}.json`;
                
                // Trigger download
                document.body.appendChild(a);
                a.click();
                
                // Cleanup
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                alert('âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯!');
            } catch (error) {
                console.error('Download error:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§: ' + error.message);
            }
        }

        window.onload = loadDashboard;
    </script>
</body>
</html>


